#!/bin/bash

# This script sets the background, using pywal to set a terminal colorscheme,or otherwise
# using Xresources. It also sets the wallpaper for me both on gnome-shell and on dwm.

#	Usage:
#		`setbg [ -s, --no-scheme ] [ -i, --input="path/to/img" ]`

bgloc=$XDG_CONFIG_HOME/wall.png


TEMP=$(getopt -o 'si:' --long 'no-scheme,input:' -- "$@" )

eval set -- "$TEMP"
unset TEMP

scheme=true

while true; do
	case "$1" in
		'-s'|'--no-scheme')
			scheme=false
			shift
			continue
		;;
		'-i'|'--input')
			[ -n $2 ] && cp "$2" $bgloc > /dev/null 2>&1 && notify-send -i "$bgloc" "Wallpaper changed."
			if [ $scheme = true ]; then
				wal -i $bgloc && wal -c
			else
				xrdb -load $XDG_CONFIG_HOME/Xresources/Xresources
			fi
			shift 2
			continue
		;;
		'--')
			shift
			break
		;;
		*)
			echo 'Error!' >&2
			exit 1
		;;
	esac
done

[ ! "$(gsettings get org.gnome.desktop.background picture-uri)" = "'file://$bgloc'" ] && gsettings set org.gnome.desktop.background picture-uri file://$bgloc
xwallpaper --zoom "$bgloc"
